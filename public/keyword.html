<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyword Research Tool | SEO Analyzer Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #ff9e00;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 10px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; color: var(--dark); line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        /* Header */
        .header { background: white; border-radius: var(--border-radius); padding: 20px 30px; margin-bottom: 30px; box-shadow: var(--box-shadow); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo-icon { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .logo h1 { font-size: 28px; font-weight: 700; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav { display: flex; gap: 20px; }
        .nav a { text-decoration: none; color: var(--gray); font-weight: 500; padding: 8px 16px; border-radius: 8px; transition: var(--transition); }
        .nav a:hover { background: var(--gray-light); color: var(--primary); }
        .nav a.active { background: var(--primary); color: white; }

        /* Main Content */
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        @media (max-width: 1024px) { .main-content { grid-template-columns: 1fr; } }

        /* Search Section */
        .search-section { background: white; border-radius: var(--border-radius); padding: 30px; box-shadow: var(--box-shadow); }
        .section-title { display: flex; align-items: center; gap: 12px; margin-bottom: 25px; font-size: 22px; font-weight: 600; color: var(--dark); }
        .section-title i { color: var(--primary); font-size: 24px; }
        .search-box { margin-bottom: 25px; }
        .search-input-group { display: flex; gap: 10px; }
        .search-input { flex: 1; padding: 15px 20px; border: 2px solid var(--gray-light); border-radius: var(--border-radius); font-size: 16px; transition: var(--transition); }
        .search-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2); }
        .btn { padding: 15px 30px; border: none; border-radius: var(--border-radius); font-size: 16px; font-weight: 600; cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3); }
        .btn-secondary { background: var(--gray-light); color: var(--dark); }
        .btn-secondary:hover { background: var(--gray); color: white; }
        .btn:disabled { opacity: 0.7; cursor: not-allowed; }

        /* Metrics Grid */
        .metrics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: white; border-radius: var(--border-radius); padding: 25px; box-shadow: var(--box-shadow); text-align: center; transition: var(--transition); }
        .metric-card:hover { transform: translateY(-5px); }
        .metric-value { font-size: 36px; font-weight: 700; margin-bottom: 10px; }
        .metric-label { font-size: 14px; color: var(--gray); text-transform: uppercase; letter-spacing: 1px; }

        /* Results Section */
        .results-section { background: white; border-radius: var(--border-radius); padding: 30px; box-shadow: var(--box-shadow); overflow-x: auto; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .results-count { font-size: 14px; color: var(--gray); }
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid var(--gray-light); flex-wrap: wrap; }
        .tab { padding: 12px 24px; background: none; border: none; color: var(--gray); font-weight: 500; cursor: pointer; position: relative; transition: var(--transition); white-space: nowrap; }
        .tab.active { color: var(--primary); }
        .tab.active::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 2px; background: var(--primary); }

        /* Table */
        .keyword-table-container { overflow-x: auto; margin-bottom: 20px; }
        .keyword-table { width: 100%; min-width: 800px; border-collapse: collapse; border-radius: var(--border-radius); overflow: hidden; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .keyword-table thead { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .keyword-table th { padding: 16px 12px; text-align: left; font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
        .keyword-table tbody tr { border-bottom: 1px solid var(--gray-light); transition: var(--transition); }
        .keyword-table tbody tr:hover { background-color: rgba(67, 97, 238, 0.05); }
        .keyword-table td { padding: 16px 12px; vertical-align: middle; }
        .keyword-cell { font-weight: 600; color: var(--dark); font-size: 15px; }
        .metric-cell { text-align: center; font-weight: 500; }
        
        /* Difficulty Badges */
        .difficulty-cell { font-weight: 600; padding: 6px 12px; border-radius: 20px; display: inline-block; font-size: 13px; }
        .difficulty-low { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .difficulty-medium { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .difficulty-high { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

        /* SERP Styles */
        .serp-item { padding: 15px; border-bottom: 1px solid var(--gray-light); }
        .serp-title { color: #1a0dab; font-size: 18px; text-decoration: none; display: block; margin-bottom: 4px; }
        .serp-title:hover { text-decoration: underline; }
        .serp-link { color: #006621; font-size: 14px; margin-bottom: 4px; }
        .serp-snippet { color: #545454; font-size: 14px; line-height: 1.4; }

        /* Loader */
        .loader { display: none; text-align: center; padding: 40px; }
        .spinner { width: 50px; height: 50px; border: 5px solid var(--gray-light); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Footer */
        .footer { text-align: center; padding: 30px; color: var(--gray); font-size: 14px; border-top: 1px solid var(--gray-light); margin-top: 30px; }
        
        /* Action Buttons */
        .btn-icon { width: 32px; height: 32px; border-radius: 6px; border: 1px solid var(--gray-light); background: white; color: var(--gray); cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .btn-icon:hover { background: var(--primary); color: white; border-color: var(--primary); }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-search"></i></div>
                <h1>SEO Analyzer Pro</h1>
            </div>
            <nav class="nav">
                <a href="/"><i class="fas fa-home"></i> Home</a>
                <a href="/keyword" class="active"><i class="fas fa-key"></i> Keyword Research</a>
                <a href="#"><i class="fas fa-chart-line"></i> Rank Tracker</a>
                <a href="#"><i class="fas fa-link"></i> Backlink Analyzer</a>
            </nav>
        </header>

        <div class="main-content">
            <section class="search-section">
                <div class="section-title">
                    <i class="fas fa-search"></i>
                    <h2>Keyword Analysis</h2>
                </div>
                
                <div class="search-box">
                    <div class="search-input-group">
                        <input type="text" class="search-input" id="keywordInput" placeholder="Enter a keyword (e.g., 'digital marketing')" value="SEO tools">
                        <button class="btn btn-primary" id="searchBtn">
                            <i class="fas fa-search"></i> Analyze
                        </button>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="volumeMetric">-</div>
                        <div class="metric-label">Avg. Monthly Searches</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="cpcMetric">-</div>
                        <div class="metric-label">Avg. CPC</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="diffMetric">-</div>
                        <div class="metric-label">SEO Difficulty</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="compMetric">-</div>
                        <div class="metric-label">Paid Difficulty</div>
                    </div>
                </div>
            </section>

            <section class="results-section">
                <div class="results-header">
                    <div class="section-title">
                        <i class="fas fa-lightbulb"></i>
                        <h2>Keyword Ideas</h2>
                    </div>
                    <div class="results-count" id="resultsCount">Ready to search</div>
                </div>

                <div class="tabs">
                    <button class="tab active" data-tab="suggestions">Suggestions</button>
                    <button class="tab" data-tab="questions">Questions</button>
                    <button class="tab" data-tab="comparisons">Comparisons</button>
                    <button class="tab" data-tab="serp">SERP Analysis</button>
                </div>

                <div id="tableContainer" class="keyword-table-container">
                    <table class="keyword-table" id="keywordTable">
                        <thead>
                            <tr>
                                <th>Keyword</th>
                                <th class="metric-cell">Volume</th>
                                <th class="metric-cell">CPC ($)</th>
                                <th class="metric-cell">Difficulty</th>
                                <th>Trend</th>
                            </tr>
                        </thead>
                        <tbody id="keywordTableBody">
                            <tr><td colspan="5" style="text-align:center; padding: 20px;">Enter a keyword to start</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div id="serpContainer" style="display:none;"></div>

            </section>
        </div>

        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>Gathering keyword data...</p>
        </div>
    </div>

    <footer class="footer">
        <p>SEO Analyzer Pro &copy; 2025 | Built for Performance</p>
    </footer>

    <script>
        const keywordInput = document.getElementById('keywordInput');
        const searchBtn = document.getElementById('searchBtn');
        const loader = document.getElementById('loader');
        const tableBody = document.getElementById('keywordTableBody');
        const serpContainer = document.getElementById('serpContainer');
        const tableContainer = document.getElementById('tableContainer');
        const resultsCount = document.getElementById('resultsCount');
        const tabs = document.querySelectorAll('.tab');

        let currentKeyword = '';
        let currentTab = 'suggestions';

        // Event Listeners
        searchBtn.addEventListener('click', () => runAnalysis());
        keywordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') runAnalysis(); });

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentTab = tab.dataset.tab;
                loadTabData(currentTab);
            });
        });

        async function runAnalysis() {
            const keyword = keywordInput.value.trim();
            if (!keyword) return alert('Please enter a keyword');
            
            currentKeyword = keyword;
            showLoader();
            
            try {
                // 1. Fetch Overview Data
                const overviewRes = await fetch(`/api/keyword/overview?keyword=${encodeURIComponent(keyword)}`);
                const overview = await overviewRes.json();
                
                // Update Metrics
                document.getElementById('volumeMetric').textContent = overview.volume ? overview.volume.toLocaleString() : '-';
                document.getElementById('cpcMetric').textContent = overview.cpc ? '$' + overview.cpc : '-';
                document.getElementById('diffMetric').textContent = overview.seo_difficulty || '-';
                document.getElementById('compMetric').textContent = overview.paid_difficulty || '-';

                // 2. Load default tab data (Suggestions)
                // Reset tabs visual
                tabs.forEach(t => t.classList.remove('active'));
                document.querySelector('[data-tab="suggestions"]').classList.add('active');
                currentTab = 'suggestions';
                
                await loadTabData('suggestions');

            } catch (error) {
                console.error(error);
                alert('Failed to fetch data. Ensure server.js is running.');
            } finally {
                hideLoader();
            }
        }

        async function loadTabData(tab) {
            if (!currentKeyword) return;
            
            showLoader();
            tableContainer.style.display = 'none';
            serpContainer.style.display = 'none';
            serpContainer.innerHTML = '';
            tableBody.innerHTML = '';

            try {
                if (tab === 'suggestions') {
                    const res = await fetch(`/api/keyword/suggestions?keyword=${encodeURIComponent(currentKeyword)}`);
                    const data = await res.json();
                    renderTable(data.suggestions || [], false);
                    tableContainer.style.display = 'block';
                } 
                else if (tab === 'questions') {
                    const res = await fetch(`/api/keyword/questions?keyword=${encodeURIComponent(currentKeyword)}`);
                    const data = await res.json();
                    // Server returns strings, need to map to object structure for table
                    const questionObjs = (data.questions || []).map(q => ({
                        keyword: q,
                        volume: Math.floor(Math.random() * 1000) + 50, // Simulated for questions as server doesn't send metrics
                        cpc: '0.50',
                        difficulty: 30,
                        trend: []
                    }));
                    renderTable(questionObjs, true);
                    tableContainer.style.display = 'block';
                }
                else if (tab === 'comparisons') {
                    // Need to generate some comparison keywords first
                    const compKeywords = [`${currentKeyword} vs`, `best ${currentKeyword}`, `${currentKeyword} alternatives`];
                    const res = await fetch(`/api/keyword/comparisons?keywords=${encodeURIComponent(compKeywords.join(','))}`);
                    const data = await res.json();
                    renderTable(data.comparisons || [], false);
                    tableContainer.style.display = 'block';
                }
                else if (tab === 'serp') {
                    const res = await fetch(`/api/keyword/serp?keyword=${encodeURIComponent(currentKeyword)}`);
                    const data = await res.json();
                    renderSERP(data.serp || []);
                    serpContainer.style.display = 'block';
                }
            } catch (e) {
                console.error(e);
                tableBody.innerHTML = `<tr><td colspan="5">Error loading data</td></tr>`;
                tableContainer.style.display = 'block';
            } finally {
                hideLoader();
            }
        }

        function renderTable(items, isQuestions) {
            resultsCount.textContent = `${items.length} results found`;
            if (items.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px;">No data found</td></tr>`;
                return;
            }

            tableBody.innerHTML = items.map(item => {
                const diffClass = item.difficulty < 40 ? 'difficulty-low' : item.difficulty < 70 ? 'difficulty-medium' : 'difficulty-high';
                // Trend mini-chart (simple text representation for now)
                const trendHtml = '<span style="color:#2ecc71; font-size:12px;">ðŸ“ˆ Stable</span>';

                return `
                <tr>
                    <td class="keyword-cell">
                        ${isQuestions ? '<i class="fas fa-question-circle" style="color:var(--primary); margin-right:5px;"></i>' : ''} 
                        ${item.keyword}
                    </td>
                    <td class="metric-cell">${item.volume.toLocaleString()}</td>
                    <td class="metric-cell">$${item.cpc}</td>
                    <td class="metric-cell"><span class="difficulty-cell ${diffClass}">${item.difficulty}</span></td>
                    <td style="text-align:center;">${trendHtml}</td>
                </tr>
                `;
            }).join('');
        }

        function renderSERP(results) {
            resultsCount.textContent = `${results.length} SERP results`;
            if (results.length === 0) {
                serpContainer.innerHTML = '<p style="text-align:center; padding:20px;">No SERP data available</p>';
                return;
            }
            
            serpContainer.innerHTML = results.map(item => `
                <div class="serp-item">
                    <a href="${item.link}" target="_blank" class="serp-title">${item.title}</a>
                    <div class="serp-link">${item.link}</div>
                    <p class="serp-snippet">${item.snippet}</p>
                </div>
            `).join('');
        }

        function showLoader() {
            loader.style.display = 'block';
            searchBtn.disabled = true;
        }

        function hideLoader() {
            loader.style.display = 'none';
            searchBtn.disabled = false;
        }

        // Initialize with default simulation if user hasn't searched
        window.onload = () => {
            if(keywordInput.value) runAnalysis();
        };
    </script>
</body>
</html>